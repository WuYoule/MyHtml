<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>

    <script type="text/javascript" src="js&css/Swipe.js"></script>
    <!--<script type="text/javascript" src="JS&CSS/qixi.js"></script>-->
    <script type="text/javascript" src="js&css/BoyWalk.js"></script>
    <style>
        * {
            margin: 0px;
            padding: 0px;
        }

        ul li {
            list-style-type: none;
        }

        /*主题部分*/
        #content {

            width: 100%;
            height: 100%;
            /*top:20%;*/
            /*left: 20%;*/
            overflow: hidden;
            position: absolute;
            border: 1px solid #ccc;
        }

        .content-wrap {
            position: relative;
        }

        .content-wrap > li {
            /*width: 100%;*/
            /*height: 100%;*/
            background: #CAE1FF;
            color: red;
            float: left;
            overflow: hidden;
            position: relative;
        }

        li:nth-child(2) {
            background: #9BCD9B;
        }

        li:nth-child(3) {
            background: yellow;
        }

        button {
            width: 100px;
            height: 50px;
        }

        .button {
            position: absolute;
            bottom: 0px;
        }

        /*小男孩*/
        .charector {
            width: 151px;
            height: 291px;
            background: url(http://img.mukewang.com/55ade248000198ae10550582.png) -0px -291px no-repeat;
            position: absolute;
            left: 6%;
            top: 55%;
        }

        /*第一幅画面*/

        .a_background {
            width: 100%;
            height: 100%;
            position: absolute;
        }

        .a_background_top {
            width: 100%;
            height: 71.6%;
            background-image: url("http://img.mukewang.com/55addf6900019d8f14410645.png");
            background-size: 100% 100%;
        }

        .a_background_middle {
            width: 100%;
            height: 13.1%;
            background-image: url("http://img.mukewang.com/55addf800001ff2e14410118.png");
            background-size: 100% 100%;
        }

        .a_background_botton {
            width: 100%;
            height: 15.3%;
            background-image: url("http://img.mukewang.com/55addfcb000189b314410138.png");
            background-size: 100% 100%;
        }

        /*人物腿的动作*/
        .slowWalk {
            -webkit-animation-name: person-slow;
            -webkit-animation-duration: 950ms;
            -webkit-animation-iteration-count: infinite;
            -webkit-animation-timing-function: steps(1, start);

            -moz-animation-name: person-slow;
            -moz-animation-duration: 950ms;
            -moz-animation-iteration-count: infinite;
            -moz-animation-timing-function: steps(1, start);
        }

        @-webkit-keyframes person-slow {
            0% {
                background-position: -0px -291px;
            }
            25% {
                background-position: -602px -0px;
            }
            50% {
                background-position: -302px -291px;
            }
            75% {
                background-position: -151px -291px;
            }
            100% {
                background-position: -0px -291px;
            }
        }

        @-moz-keyframes person-slow {
            0% {
                background-position: -0px -291px;
            }
            25% {
                background-position: -602px -0px;
            }
            50% {
                background-position: -302px -291px;
            }
            75% {
                background-position: -151px -291px;
            }
            100% {
                background-position: -0px -291px;
            }
        }

        /* 人物停止腿的动作 */
        .pauseWalk {
            -webkit-animation-play-state: paused;
            -moz-animation-play-state: paused;
        }


        /*-------- 太阳自转以及动画 --------*/
        #sun {
            background: url("http://img.mukewang.com/55ade004000106c202010201.png") no-repeat;
            position: absolute;
            z-index: 1;
            top: -30px;
            height: 201px;
            width: 201px;
            right: 40%;
        }

        .rotation {
            -webkit-animation-name: rotation;
            -webkit-animation-duration: 30s;
            -moz-animation-name: rotation;
            -moz-animation-duration: 30s;
        }

        @-webkit-keyframes rotation {
            0% {
                transform: translateX(0) translateY(0);
            }
            100% {
                transform: translateX(-2000px) translateY(400px);
            }
        }

        @-moz-keyframes rotation {
            0% {
                transform: translateX(0) translateY(0);
            }
            100% {
                transform: translateX(-2000px) translateY(400px);
            }
        }
        /* 天空云 */

        .cloud {
            z-index: 2;
            position: absolute;
        }

        .cloud1 {
            width: 181px;
            height: 101px;
            left: -5%;
            top: 15%;
            background: url("http://img.mukewang.com/55addfde0001aec501810101.png");
        }


        .cloud2 {
            width: 301px;
            height: 140px;
            right: -5%;
            background: url("http://img.mukewang.com/55addff500016df503010140.png");
        }

        .cloud1Anim{
            -webkit-animation-name: smallCloud;
            -webkit-animation-duration: 30s;
            -webkit-animation-iteration: infinite;
            -moz-animation-name: smallCloud;
            -moz-animation-duration: 30s;
            -moz-animation-iteration: infinite;
        }

        .cloud2Anim{
            -webkit-animation-name: largeCloud;
            -webkit-animation-duration: 60s;
            -webkit-animation-iteration: infinite;
            -moz-animation-name: largeCloud;
            -moz-animation-duration: 60s;
            -moz-animation-iteration: infinite;
        }


        @-webkit-keyframes smallCloud {
            0% {
                left: -5%;
            }
            100% {
                left: 100%;
            }
        }

        @-moz-keyframes smallCloud {
            0% {
                left: -5%;
            }
            100% {
                left: 100%;
            }
        }

        @-webkit-keyframes largeCloud {
            0% {
                right: -5%;
            }
            100% {
                right: 100%;
            }
        }

        @-moz-keyframes largeCloud {
            0% {
                right: -5%;
            }
            100% {
                right: 100%;
            }
        }
        /*第二幅画面*/

        .b_background {
            width: 100%;
            height: 100%;
            background-image: url("http://img.mukewang.com/55ade06f00015a0d14410901.png");
            background-size: 100% 100%;
            position: absolute;
        }

        .b_background_preload {
            background: url("http://img.mukewang.com/55ade0be0001a37914410901.png") no-repeat -9999px -9999px;
        }

        .lamp-bright {
            background-image: url("http://img.mukewang.com/55ade0be0001a37914410901.png");
        }


        /*商店*/

        .shop {
            width: 39.5%;
            height: 35.5%;
            position: absolute;
            left: 29%;
            top: 36.5%;
        }

        .door {
            position: absolute;
            width: 32%;
            height: 100%;
            top: 32%;
            height: 68%;
            overflow: hidden;
            left: 58.5%;
        }

        .door-left,
        .door-right {
            width: 50%;
            height: 100%;
            position: absolute;
        }

        .door-left {
            left: 0%;
            background: url(http://img.mukewang.com/55ade1140001050d00910231.png);
            background-size: 100% 100%;
        }

        .door-right {
            left: 50%;
            background: url(http://img.mukewang.com/55ade12100019f5b00910231.png);
            background-size: 100% 100%;
        }
    </style>
</head>
<body>
<div id='content'>
    <ul class='content-wrap'>
        <!-- 第一副画面 -->
        <li>
            <div class="a_background">
                <div class="a_background_top"></div>
                <div class="a_background_middle"></div>
                <div class="a_background_botton"></div>
            </div>
            <!-- 云 -->
            <div class="cloudArea">
                <div class="cloud cloud1"></div>
                <div class="cloud cloud2"></div>
            </div>
            <!-- 太阳 -->
            <div id="sun"></div>
        </li>
        <!-- 第二副画面 -->
        <li>
            <!-- 背景图 -->
            <div class="b_background"></div>
            <div class="b_background_preload"></div>
            <!-- 商店 -->
            <div class="shop">
                <div class="door">
                    <div class="door-left"></div>
                    <div class="door-right"></div>
                </div>
                <!-- 灯 -->
                <div class="lamp"></div>
            </div>
        </li>
        <!-- 第三副画面 -->
        <li> 页面3</li>
    </ul>
    <div class="button">
        <button>开始</button>
        <button>暂停</button>
    </div>
    <div id="boy" class="charector"></div>
</div>
<script type="text/javascript">

//    var swipe = Swipe($("#content"));
    //给按钮绑定事件
    //    $(".button").click(function () {
    //       swipe.scrollTo($("#content").width()*2,5000)
    //    });

//    var getValue = function (className) {
//        var $elem = $('' + className + '');
//        return {
//            height: $elem.height(),
//            top: $elem.position().top
//        };
//    };

//    var pathY = function () {
//        var data = getValue('.a_background_middle');
//        return data.top + data.height / 2;
//    }();

//    var $boy = $("#boy");
//    var boyHeight = $boy.height();

//    $boy.css({
//        top: pathY - boyHeight + 25
//    });
//    $boy.addClass('slowWalk');
//    $('button:first').click(function () {
//         增加走路的CSS3关键帧规则
//        $('#boy').css({
//            'top':'325px',
//            'left':$('#content').width()+'px',
//            'left':'325px',
//            'transition':'all  10s linear'
//        });
//    });
    // 暂停
//    $("button:last").click(function() {
//        var left = $boy.css('left');
//        // 强制做了一个改变目标left的处理
//        // 动画是要运行10秒,所以此时动画还是没有结束的
//        $boy.css('left',left);
//        // 增加暂停的样式
//        $boy.addClass('pauseWalk');
//    });


    $(function(){
//        $("button:first").click(function(){
//            var distX=calculateDist('x',0.5);
//            var distY=calculateDist('y',0.5);
//            alert(distX+','+distY);
//            walkRun('10',distX,distY);
//      });


        var container = $("#content");
        var swipe = Swipe(container);
        // 页面滚动到指定的位置
        function scrollTo(time, proportionX) {
            var distX = container.width() * proportionX;
            swipe.scrollTo(distX, time);

        }
        //////////
        // 小孩走路 //
        //////////

        //用来临时调整页面
        swipe.scrollTo(container.width(), 0);



        var boy =BoyWalk();
        function startRun() {

            boy.walkTo(2000, 0.5)
                    .then(function() {
                        //暂停走路
                        boy.stopWalk()
                    })
                    .then(function() {
                        //开门
                        return openDoor();
                    })
                    .then(function() {
                        //开灯
                        lamp.bright()
                    })
                    .then(function() {
                        //进商店
                        return boy.toShop(2000)
                    }).then(function() {
                        //出商店
                        return boy.outShop(2000)
                    }).then(function() {
                        //灯暗
                        lamp.dark()
                    });
        }
        function doorAction(left,right,time){
            var $door=$('door');
            var doorLeft=$('.door-left');
            var doorRight=$('.door-right');
            var defer= $.Deferred();
            var count=2;
            //等待门打开
            var complete= function () {
                if(count==1){
                    defer.resolve();
                    return;
                }
                count--;
            };
            doorLeft.animate({'left':left},time,complete());
            doorRight.animate({'left':right},time,complete());
            return defer;

        }
        // 开门
        function openDoor() {
            return doorAction('-50%', '100%', 2000);
        }

        // 关门
        function shutDoor() {
            return doorAction('0%', '50%', 2000);
        }


        ///////////
        // 灯动画 //
        ///////////
        var lamp = {
            elem: $('.b_background'),
            bright: function() {
                this.elem.addClass('lamp-bright')
            },
            dark: function() {
                this.elem.removeClass('lamp-bright')
            }
        };

        // 开门
//        $("button:first").click(function() {
//            // 开门
//            openDoor().then(function() {
//                // 开灯
//                lamp.bright();
//            });
//        });

        // 关门
//        $("button:last").click(function() {
//            // 关门
//            shutDoor().then(function() {
//                // 灯灭
//                lamp.dark();
//            });
//
//        });
        // 开始
        $("button:first").click(startRun);
        // 开始
//        $("button:first").click(function() {
//            // 太阳公转
//            $("#sun").addClass('rotation');
//            // 飘云
//            $(".cloud:first").addClass('cloud1Anim');
//            $(".cloud:last").addClass('cloud2Anim');
//
//            // 开始第一次走路
//            boy.walkTo(2000, 0.2)
//                    .then(function() {
//                        //第一次走路完成
//                        boy.setColoer('red');
//                        scrollTo(5000, 1);
//                    }).then(function() {
//                        //第二次走
//                        return boy.walkTo(2000, 0.5)
//                    })
////                    .then(function() {
////                        //第二次走路完成
////                        boy.setColoer('yellow')
////                    }).then(function() {
////                        //第三次走路
////                        return boy.walkTo(2000, 0.6)
////                    }).then(function() {
////                        //第三次走路完成
////                        boy.setColoer('blue')
////                    });
//
//        });
    })
</script>
<script src="js&css/qixi02.js"></script>
</body>
</html>
